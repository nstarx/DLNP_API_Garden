<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Design Documentation Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-http.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Custom styles for markdown content */
        .markdown-body h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .markdown-body h2 {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        .markdown-body h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        
        .markdown-body h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .markdown-body p {
            margin-bottom: 1rem;
            line-height: 1.75;
        }
        
        .markdown-body ul, .markdown-body ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }
        
        .markdown-body ul {
            list-style-type: disc;
        }
        
        .markdown-body ol {
            list-style-type: decimal;
        }
        
        .markdown-body li {
            margin-bottom: 0.5rem;
        }
        
        .markdown-body table {
            width: 100%;
            margin-bottom: 1.5rem;
            border-collapse: collapse;
        }
        
        .markdown-body th {
            background-color: #f3f4f6;
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }
        
        .markdown-body td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
        }
        
        .markdown-body tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        .markdown-body code {
            background-color: #f3f4f6;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            color: #dc2626;
        }
        
        .markdown-body pre {
            background-color: #1e293b;
            color: #f1f5f9;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        .markdown-body pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        
        .markdown-body blockquote {
            border-left: 4px solid #3b82f6;
            padding-left: 1rem;
            margin: 1rem 0;
            font-style: italic;
            color: #6b7280;
        }
        
        .markdown-body hr {
            margin: 2rem 0;
            border-color: #e5e7eb;
        }
        
        .markdown-body a {
            color: #3b82f6;
            text-decoration: underline;
        }
        
        .markdown-body a:hover {
            color: #2563eb;
        }
        
        /* Dark mode styles */
        .dark .markdown-body h1,
        .dark .markdown-body h2,
        .dark .markdown-body h3,
        .dark .markdown-body h4 {
            color: #f3f4f6;
        }
        
        .dark .markdown-body {
            color: #d1d5db;
        }
        
        .dark .markdown-body th {
            background-color: #374151;
            border-color: #4b5563;
        }
        
        .dark .markdown-body td {
            border-color: #4b5563;
        }
        
        .dark .markdown-body tr:nth-child(even) {
            background-color: #1f2937;
        }
        
        .dark .markdown-body code {
            background-color: #374151;
            color: #f87171;
        }
        
        .dark .markdown-body blockquote {
            color: #9ca3af;
        }
        
        .dark .markdown-body hr {
            border-color: #4b5563;
        }
        
        /* Sidebar scrollbar */
        .sidebar-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }
        
        .sidebar-scroll::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Loading animation */
        .loader {
            border-top-color: #3b82f6;
            animation: spinner 1.5s linear infinite;
        }
        
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <style>
        /* Diagrams view styles */
        .diagram-wrapper { transition: transform 0.2s ease; transform-origin: 0 0; }
        .diagram-container { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1rem; }
        .dark .diagram-container { background: #1f2937; }
        .btn { padding: 0.5rem 0.75rem; border-radius: 0.375rem; background: #e5e7eb; color: #111827; }
        .btn:hover { background: #d1d5db; }
        .dark .btn { background: #374151; color: #f3f4f6; }
        .dark .btn:hover { background: #4b5563; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-code text-3xl text-blue-600"></i>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">API Design Documentation Hub</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        <i class="fas fa-moon text-gray-700 dark:text-yellow-400"></i>
                    </button>
                    
                    <!-- Diagrams View Toggle -->
                    <a href="#" id="openDiagrams" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" title="All Mermaid Diagrams">
                        <i class="fas fa-diagram-project text-2xl"></i>
                    </a>
                    
                    <!-- API Sequence Builder Toggle -->
                    <a href="#" id="openSequenceBuilder" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white" title="API Sequence Builder">
                        <i class="fas fa-layer-group text-2xl"></i>
                    </a>
                    
                    <!-- GitHub Link -->
                    <a href="https://github.com" target="_blank" class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                        <i class="fab fa-github text-2xl"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div id="docsView" class="container mx-auto px-4 py-8">
        <div class="flex gap-6">
            
            <!-- Sidebar -->
            <aside class="w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg h-fit sticky top-24">
                <div class="p-4 border-b dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-list mr-2"></i>
                        API Documentation Files
                    </h2>
                </div>
                
                <!-- File List -->
                <div id="fileList" class="sidebar-scroll max-h-[calc(100vh-200px)] overflow-y-auto p-4">
                    <!-- Files will be listed here -->
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <main class="flex-1">
                <!-- Welcome Screen -->
                <div id="welcomeScreen" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-12 text-center">
                    <i class="fas fa-book-open text-6xl text-blue-600 mb-6"></i>
                    <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Welcome to API Documentation Hub</h2>
                    <p class="text-gray-600 dark:text-gray-300">Select an API design document from the sidebar to view its contents</p>
                </div>
                
                <!-- Document Content -->
                <div id="documentContent" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
                    <div class="mb-6">
                        <h2 id="docTitle" class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Document Title</h2>
                        <p id="docPath" class="text-sm text-gray-600 dark:text-gray-400">
                            <i class="fas fa-file-alt mr-1"></i>
                            <span></span>
                        </p>
                    </div>
                    
                    <div id="markdownContent" class="markdown-body">
                        <!-- Markdown will be rendered here -->
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loadingState" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-12 text-center">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4 mx-auto"></div>
                    <p class="text-gray-600 dark:text-gray-300">Loading document...</p>
                </div>
                
                <!-- Error State -->
                <div id="errorState" class="hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-12 text-center">
                    <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-6"></i>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Error Loading Document</h2>
                    <p id="errorMessage" class="text-gray-600 dark:text-gray-300"></p>
                </div>
            </main>
        </div>
    </div>

    <!-- Diagrams View (integrated) -->
    <div id="diagramsView" class="container mx-auto px-4 py-8 hidden">
        <div class="w-full">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-3 mb-4 flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <button id="prevBtn" class="btn" title="Previous diagram"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextBtn" class="btn" title="Next diagram"><i class="fas fa-chevron-right"></i></button>
                    <span class="text-gray-700 dark:text-gray-300 ml-2" id="counter">0 / 0</span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="zoomOutBtn" class="btn" title="Zoom out"><i class="fas fa-magnifying-glass-minus"></i></button>
                    <button id="zoomResetBtn" class="btn" title="Reset zoom"><i class="fas fa-magnifying-glass"></i></button>
                    <button id="zoomInBtn" class="btn" title="Zoom in"><i class="fas fa-magnifying-glass-plus"></i></button>
                    <button id="closeDiagrams" class="btn" title="Back to Docs"><i class="fas fa-book-open"></i></button>
                </div>
            </div>
            <div id="gallery" class="space-y-6"></div>
            <div id="emptyState" class="hidden text-center p-12 bg-white dark:bg-gray-800 rounded-lg shadow">
                <i class="far fa-face-frown text-5xl text-gray-400 mb-4"></i>
                <p class="text-gray-700 dark:text-gray-300">No Mermaid diagrams found in the configured documents.</p>
            </div>
        </div>
    </div>
    
    <!-- API Sequence Builder View -->
    <div id="sequenceBuilderView" class="container mx-auto px-4 py-8 hidden">
        <div class="flex gap-6">
            <!-- Left Panel: API Explorer -->
            <div class="w-1/3 bg-white dark:bg-gray-800 rounded-lg shadow-lg h-fit sticky top-24">
                <div class="p-4 border-b dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                        <i class="fas fa-list-ul mr-2"></i>
                        Available APIs
                    </h2>
                    <input type="text" id="apiSearch" placeholder="Search APIs..." 
                           class="mt-3 w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div id="apiList" class="max-h-[calc(100vh-300px)] overflow-y-auto p-4">
                    <!-- API endpoints will be loaded here -->
                </div>
            </div>
            
            <!-- Middle Panel: Sequence Builder -->
            <div class="flex-1">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="fas fa-layer-group mr-2"></i>
                            API Sequence Builder
                        </h2>
                        <div class="flex gap-3">
                            <button id="clearSequence" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                <i class="fas fa-trash mr-2"></i>Clear
                            </button>
                            <button id="saveToCart" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-shopping-cart mr-2"></i>Save to Cart
                            </button>
                            <button id="executeSequence" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-play mr-2"></i>Execute
                            </button>
                            <button id="closeSequenceBuilder" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                <i class="fas fa-times mr-2"></i>Close
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Sequence Name
                        </label>
                        <input type="text" id="sequenceName" placeholder="Enter sequence name..."
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            API Calls Sequence
                        </label>
                        <div id="sequenceList" class="space-y-3 min-h-[200px] border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4">
                            <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                                <i class="fas fa-plus-circle text-4xl mb-2"></i>
                                <p>Drag API endpoints here or click "Add to Sequence"</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">
                            <i class="fas fa-cog mr-2"></i>Sequence Configuration
                        </h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Delay Between Calls (ms)
                                </label>
                                <input type="number" id="sequenceDelay" value="1000" min="0"
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    Retry on Failure
                                </label>
                                <select id="retryOnFailure" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                                    <option value="0">No Retry</option>
                                    <option value="1">1 Retry</option>
                                    <option value="2">2 Retries</option>
                                    <option value="3">3 Retries</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Execution Results -->
                <div id="executionResults" class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="fas fa-terminal mr-2"></i>Execution Results
                    </h3>
                    <div id="resultsContent" class="space-y-3">
                        <!-- Results will appear here -->
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Saved Sequences Cart -->
            <div class="w-1/4 bg-white dark:bg-gray-800 rounded-lg shadow-lg h-fit sticky top-24">
                <div class="p-4 border-b dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center justify-between">
                        <span><i class="fas fa-shopping-cart mr-2"></i>Saved Sequences</span>
                        <span id="cartCount" class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">0</span>
                    </h2>
                </div>
                <div id="savedSequences" class="max-h-[calc(100vh-300px)] overflow-y-auto p-4">
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No saved sequences</p>
                    </div>
                </div>
                <div class="p-4 border-t dark:border-gray-700">
                    <button id="exportSequences" class="w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-download mr-2"></i>Export All
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration - Load files from ./design folder
        const API_FILES = [
            'design/admin-rest-api-design.md',
            'design/agentic-rest-api-design.md',
            'design/ai-system-rest-api-design.md',
            'design/ai-catalog-rest-api-design.md',
            'design/assets-platform-rest-api-design.md',
            'design/cicd-platform-rest-api-design.md',
            'design/composables-ai-catalog-rest-api-design.md',
            'design/connections-platform-rest-api-design.md',
            'design/data-platform-rest-api-design.md',
            'design/deployments-platform-rest-api-design.md',
            'design/federation-fl-platform-rest-api-design.md',
            'design/rag-platform-rest-api-design.md',
            'design/spark-services-platform-rest-api-design.md',
            'design/views-ui-platform-rest-api-design.md',
            'design/api-statistics-report.md'
        ];
        
        // State
        let currentFile = null;
        let currentContent = null;
        
        // API Sequence Builder State
        let apiEndpoints = [];
        let currentSequence = [];
        let savedSequences = [];
        let sequenceIdCounter = 1;
        
        // Load API endpoints from the data file
        async function loadAPIEndpoints() {
            try {
                const response = await fetch('design/api-endpoints-data.json');
                if (response.ok) {
                    const data = await response.json();
                    apiEndpoints = data.endpoints.map((endpoint, index) => ({
                        ...endpoint,
                        id: endpoint.id || `api-${index}`,
                        source: endpoint.file || endpoint.source || 'Unknown'
                    }));
                    renderAPIList();
                }
            } catch (error) {
                console.error('Error loading API endpoints:', error);
                // Fallback: Parse from markdown files
                await loadAPIEndpointsFromMarkdown();
            }
        }
        
        // Fallback: Parse API endpoints from markdown files
        async function loadAPIEndpointsFromMarkdown() {
            const endpoints = [];
            for (const file of API_FILES) {
                try {
                    const response = await fetch(file);
                    if (!response.ok) continue;
                    const content = await response.text();
                    
                    // Extract API endpoints using regex
                    const regex = /(GET|POST|PUT|PATCH|DELETE)\s+(\/api\/[^\s\n]+)/gm;
                    let match;
                    while ((match = regex.exec(content)) !== null) {
                        endpoints.push({
                            method: match[1],
                            path: match[2],
                            source: file.replace('design/', '').replace('.md', ''),
                            id: `api-${endpoints.length}`
                        });
                    }
                } catch (error) {
                    console.log(`Failed to parse ${file}:`, error);
                }
            }
            apiEndpoints = endpoints;
            renderAPIList();
        }
        
        // Render API list in the left panel
        function renderAPIList() {
            const apiList = document.getElementById('apiList');
            if (!apiList) return;
            
            const grouped = {};
            apiEndpoints.forEach(endpoint => {
                const group = endpoint.source || 'Unknown';
                if (!grouped[group]) grouped[group] = [];
                grouped[group].push(endpoint);
            });
            
            let html = '';
            Object.keys(grouped).sort().forEach(group => {
                html += `
                    <div class="mb-4">
                        <h3 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">${group}</h3>
                        <div class="space-y-1">
                `;
                
                grouped[group].forEach(endpoint => {
                    const methodColor = {
                        GET: 'text-green-600',
                        POST: 'text-blue-600',
                        PUT: 'text-yellow-600',
                        PATCH: 'text-purple-600',
                        DELETE: 'text-red-600'
                    }[endpoint.method] || 'text-gray-600';
                    
                    html += `
                        <div class="api-endpoint p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors"
                             data-endpoint='${JSON.stringify(endpoint)}'>
                            <span class="${methodColor} font-mono text-xs font-semibold">${endpoint.method}</span>
                            <span class="ml-2 text-sm text-gray-800 dark:text-gray-200">${endpoint.path}</span>
                            <button class="float-right text-blue-500 hover:text-blue-700" onclick="addToSequence('${endpoint.id}')">
                                <i class="fas fa-plus-circle"></i>
                            </button>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            apiList.innerHTML = html || '<p class="text-gray-500 dark:text-gray-400 text-center">No APIs loaded</p>';
        }
        
        // Add API to sequence
        function addToSequence(endpointId) {
            const endpoint = apiEndpoints.find(e => e.id === endpointId);
            if (!endpoint) return;
            
            const sequenceItem = {
                ...endpoint,
                sequenceId: `seq-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                params: {},
                headers: {},
                body: null
            };
            
            currentSequence.push(sequenceItem);
            renderSequence();
        }
        
        // Render current sequence
        function renderSequence() {
            const sequenceList = document.getElementById('sequenceList');
            if (!sequenceList) return;
            
            if (currentSequence.length === 0) {
                sequenceList.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        <i class="fas fa-plus-circle text-4xl mb-2"></i>
                        <p>Drag API endpoints here or click "Add to Sequence"</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            currentSequence.forEach((item, index) => {
                const methodColor = {
                    GET: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
                    POST: 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
                    PUT: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
                    PATCH: 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
                    DELETE: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
                }[item.method] || 'bg-gray-100 text-gray-800';
                
                html += `
                    <div class="sequence-item bg-white dark:bg-gray-700 p-3 rounded-lg shadow border border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <span class="sequence-number bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 px-2 py-1 rounded text-sm font-semibold mr-3">${index + 1}</span>
                                <span class="${methodColor} px-2 py-1 rounded text-xs font-semibold">${item.method}</span>
                                <span class="ml-2 text-sm font-mono text-gray-700 dark:text-gray-200">${item.path}</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="moveSequenceItem(${index}, -1)" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" ${index === 0 ? 'disabled' : ''}>
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                                <button onclick="moveSequenceItem(${index}, 1)" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" ${index === currentSequence.length - 1 ? 'disabled' : ''}>
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                                <button onclick="editSequenceItem(${index})" class="text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="removeFromSequence(${index})" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400">
                            Source: ${item.source}
                        </div>
                    </div>
                `;
            });
            
            sequenceList.innerHTML = html;
        }
        
        // Move sequence item up or down
        function moveSequenceItem(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= currentSequence.length) return;
            
            const temp = currentSequence[index];
            currentSequence[index] = currentSequence[newIndex];
            currentSequence[newIndex] = temp;
            renderSequence();
        }
        
        // Remove item from sequence
        function removeFromSequence(index) {
            currentSequence.splice(index, 1);
            renderSequence();
        }
        
        // Edit sequence item (placeholder for future enhancement)
        function editSequenceItem(index) {
            alert('Edit functionality coming soon! You can configure headers, parameters, and body for each API call.');
        }
        
        // Clear sequence
        function clearSequence() {
            if (currentSequence.length > 0 && confirm('Are you sure you want to clear the current sequence?')) {
                currentSequence = [];
                renderSequence();
            }
        }
        
        // Save sequence to cart
        function saveSequenceToCart() {
            if (currentSequence.length === 0) {
                alert('Please add at least one API call to the sequence');
                return;
            }
            
            const sequenceName = document.getElementById('sequenceName').value || `Sequence ${sequenceIdCounter}`;
            const sequence = {
                id: `saved-${Date.now()}`,
                name: sequenceName,
                items: [...currentSequence],
                delay: document.getElementById('sequenceDelay').value || 1000,
                retryOnFailure: document.getElementById('retryOnFailure').value || 0,
                createdAt: new Date().toISOString()
            };
            
            savedSequences.push(sequence);
            sequenceIdCounter++;
            renderSavedSequences();
            
            // Clear current sequence after saving
            currentSequence = [];
            renderSequence();
            document.getElementById('sequenceName').value = '';
            
            alert(`Sequence "${sequenceName}" saved to cart!`);
        }
        
        // Render saved sequences
        function renderSavedSequences() {
            const savedSequencesEl = document.getElementById('savedSequences');
            const cartCount = document.getElementById('cartCount');
            
            if (!savedSequencesEl) return;
            
            cartCount.textContent = savedSequences.length;
            
            if (savedSequences.length === 0) {
                savedSequencesEl.innerHTML = `
                    <div class="text-center text-gray-500 dark:text-gray-400 py-8">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No saved sequences</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            savedSequences.forEach((sequence, index) => {
                html += `
                    <div class="saved-sequence bg-gray-50 dark:bg-gray-700 p-3 rounded-lg mb-3">
                        <div class="font-semibold text-gray-800 dark:text-gray-200 mb-1">${sequence.name}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                            ${sequence.items.length} API calls â€¢ Created ${new Date(sequence.createdAt).toLocaleString()}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="loadSequence(${index})" class="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                                <i class="fas fa-folder-open mr-1"></i>Load
                            </button>
                            <button onclick="deleteSavedSequence(${index})" class="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                                <i class="fas fa-trash mr-1"></i>Delete
                            </button>
                        </div>
                    </div>
                `;
            });
            
            savedSequencesEl.innerHTML = html;
        }
        
        // Load saved sequence
        function loadSequence(index) {
            const sequence = savedSequences[index];
            if (!sequence) return;
            
            currentSequence = [...sequence.items];
            document.getElementById('sequenceName').value = sequence.name;
            document.getElementById('sequenceDelay').value = sequence.delay;
            document.getElementById('retryOnFailure').value = sequence.retryOnFailure;
            
            renderSequence();
        }
        
        // Delete saved sequence
        function deleteSavedSequence(index) {
            if (confirm('Are you sure you want to delete this sequence?')) {
                savedSequences.splice(index, 1);
                renderSavedSequences();
            }
        }
        
        // Execute sequence (mock implementation)
        async function executeSequence() {
            if (currentSequence.length === 0) {
                alert('Please add at least one API call to the sequence');
                return;
            }
            
            const resultsEl = document.getElementById('executionResults');
            const resultsContent = document.getElementById('resultsContent');
            
            resultsEl.classList.remove('hidden');
            resultsContent.innerHTML = '<div class="text-gray-500">Executing sequence...</div>';
            
            const delay = parseInt(document.getElementById('sequenceDelay').value) || 1000;
            const retries = parseInt(document.getElementById('retryOnFailure').value) || 0;
            
            let html = '';
            for (let i = 0; i < currentSequence.length; i++) {
                const item = currentSequence[i];
                
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, delay));
                
                const status = Math.random() > 0.2 ? 'success' : 'error';
                const statusColor = status === 'success' ? 'text-green-600' : 'text-red-600';
                const statusIcon = status === 'success' ? 'check-circle' : 'times-circle';
                
                html += `
                    <div class="result-item p-3 bg-gray-50 dark:bg-gray-700 rounded">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="font-mono text-sm">${item.method} ${item.path}</span>
                            </div>
                            <div class="${statusColor}">
                                <i class="fas fa-${statusIcon}"></i> ${status}
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Response time: ${Math.floor(Math.random() * 500 + 100)}ms
                        </div>
                    </div>
                `;
                
                resultsContent.innerHTML = html;
            }
            
            resultsContent.innerHTML = html + `
                <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900 rounded text-blue-800 dark:text-blue-200">
                    <i class="fas fa-info-circle mr-2"></i>
                    Sequence execution completed. This is a mock execution for demonstration purposes.
                </div>
            `;
        }
        
        // Export sequences
        function exportSequences() {
            if (savedSequences.length === 0) {
                alert('No sequences to export');
                return;
            }
            
            const data = JSON.stringify(savedSequences, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `api-sequences-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Setup sequence builder
        function setupSequenceBuilder() {
            // Open/Close handlers
            document.getElementById('openSequenceBuilder').addEventListener('click', (e) => {
                e.preventDefault();
                showSequenceBuilder();
            });
            
            document.getElementById('closeSequenceBuilder').addEventListener('click', () => {
                hideSequenceBuilder();
            });
            
            // Button handlers
            document.getElementById('clearSequence').addEventListener('click', clearSequence);
            document.getElementById('saveToCart').addEventListener('click', saveSequenceToCart);
            document.getElementById('executeSequence').addEventListener('click', executeSequence);
            document.getElementById('exportSequences').addEventListener('click', exportSequences);
            
            // Search functionality
            document.getElementById('apiSearch').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const apiEndpointElements = document.querySelectorAll('.api-endpoint');
                
                apiEndpointElements.forEach(el => {
                    const text = el.textContent.toLowerCase();
                    el.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            });
        }
        
        // Show sequence builder view
        function showSequenceBuilder() {
            document.getElementById('docsView').classList.add('hidden');
            document.getElementById('diagramsView').classList.add('hidden');
            document.getElementById('sequenceBuilderView').classList.remove('hidden');
            
            // Load API endpoints if not already loaded
            if (apiEndpoints.length === 0) {
                loadAPIEndpoints();
            }
        }
        
        // Hide sequence builder view
        function hideSequenceBuilder() {
            document.getElementById('sequenceBuilderView').classList.add('hidden');
            document.getElementById('docsView').classList.remove('hidden');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Page loaded, initializing...');
            
            // Initialize theme
            initializeTheme();
            
            // Setup event listeners
            setupEventListeners();

            // Setup diagrams view toggle
            setupDiagramsView();
            
            // Setup API sequence builder
            setupSequenceBuilder();
            
            // Load file list
            await loadFileList();
            
            // Check URL hash for direct link
            checkURLHash();
        });
        
        // Initialize theme
        function initializeTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.classList.toggle('dark', theme === 'dark');
            updateThemeIcon(theme);
        }
        
        // Update theme icon
        function updateThemeIcon(theme) {
            const icon = document.querySelector('#themeToggle i');
            icon.className = theme === 'dark' ? 'fas fa-sun text-yellow-400' : 'fas fa-moon text-gray-700';
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                const theme = isDark ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
                updateThemeIcon(theme);
            });
            
            // Handle browser back/forward
            window.addEventListener('popstate', checkURLHash);
        }
        
        // Diagrams view state
        let diagrams = [];
        let diagramsLoaded = false;
        let diagramCurrentIndex = 0;
        let diagramZoom = 1;
        
        function setupDiagramsView() {
            const open = document.getElementById('openDiagrams');
            const close = document.getElementById('closeDiagrams');
            open.addEventListener('click', (e) => {
                e.preventDefault();
                showDiagramsView();
            });
            close.addEventListener('click', () => {
                hideDiagramsView();
            });
            // Hook control buttons
            document.getElementById('prevBtn').addEventListener('click', () => navigateDiagram(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateDiagram(1));
            document.getElementById('zoomInBtn').addEventListener('click', () => changeDiagramZoom(0.1));
            document.getElementById('zoomOutBtn').addEventListener('click', () => changeDiagramZoom(-0.1));
            document.getElementById('zoomResetBtn').addEventListener('click', () => setDiagramZoom(1));
            document.addEventListener('keydown', (e) => {
                const dv = document.getElementById('diagramsView');
                const isVisible = !dv.classList.contains('hidden');
                if (!isVisible) return;
                if (e.key === 'ArrowLeft') navigateDiagram(-1);
                if (e.key === 'ArrowRight') navigateDiagram(1);
                if ((e.ctrlKey || e.metaKey) && e.key === '+') { e.preventDefault(); changeDiagramZoom(0.1); }
                if ((e.ctrlKey || e.metaKey) && e.key === '-') { e.preventDefault(); changeDiagramZoom(-0.1); }
                if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === '0') { e.preventDefault(); setDiagramZoom(1); }
            });
        }
        
        function showDiagramsView() {
            document.getElementById('docsView').classList.add('hidden');
            document.getElementById('diagramsView').classList.remove('hidden');
            if (!diagramsLoaded) {
                loadAllMermaidBlocks();
            }
        }
        
        function hideDiagramsView() {
            document.getElementById('diagramsView').classList.add('hidden');
            document.getElementById('docsView').classList.remove('hidden');
        }
        
        async function loadAllMermaidBlocks() {
            // Determine available files
            const available = [];
            for (const file of API_FILES) {
                try {
                    const head = await fetch(file, { method: 'HEAD' });
                    if (head.ok) available.push(file);
                } catch {}
            }
            const found = [];
            for (const file of available) {
                try {
                    const res = await fetch(file);
                    if (!res.ok) continue;
                    const text = await res.text();
                    const blocks = extractMermaidBlocks(text);
                    blocks.forEach((code, idx) => {
                        found.push({ sourceFile: file, code, idx });
                    });
                } catch {}
            }
            const counter = document.getElementById('counter');
            const empty = document.getElementById('emptyState');
            const gallery = document.getElementById('gallery');
            if (found.length === 0) {
                empty.classList.remove('hidden');
                counter.textContent = '0 / 0';
                diagramsLoaded = true;
                return;
            }
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ startOnLoad: false });
            }
            gallery.innerHTML = '';
            diagrams = [];
            for (let i = 0; i < found.length; i++) {
                const item = found[i];
                const container = document.createElement('div');
                container.className = 'diagram-container';
                const header = document.createElement('div');
                header.className = 'flex items-center justify-between mb-2';
                header.innerHTML = `
                  <div class="text-sm text-gray-600 dark:text-gray-300"><i class="fas fa-file"></i>
                    <span class="ml-1">${item.sourceFile} #${item.idx + 1}</span>
                  </div>
                  <div class="flex gap-2">
                    <a class="btn" target="_blank" href="${item.sourceFile}"><i class="fas fa-link"></i></a>
                    <button class="btn copyBtn" title="Copy code"><i class="fas fa-copy"></i></button>
                  </div>`;
                const wrapper = document.createElement('div');
                wrapper.className = 'diagram-wrapper overflow-auto';
                wrapper.style.transform = `scale(${diagramZoom})`;
                const md = document.createElement('div');
                md.className = 'mermaid';
                md.textContent = item.code;
                wrapper.appendChild(md);
                container.appendChild(header);
                container.appendChild(wrapper);
                gallery.appendChild(container);
                diagrams.push({ id: i, sourceFile: item.sourceFile, code: item.code, element: container });
            }
            await new Promise(r => setTimeout(r, 0));
            if (typeof mermaid !== 'undefined') {
                mermaid.init(undefined, document.querySelectorAll('#gallery .mermaid'));
            }
            diagramCurrentIndex = 0;
            updateDiagramCounter();
            updateDiagramFocus();
            // copy buttons
            document.querySelectorAll('.copyBtn').forEach((btn, idx) => {
                btn.addEventListener('click', () => copyToClipboard(found[idx].code));
            });
            diagramsLoaded = true;
        }
        
        function extractMermaidBlocks(md) {
            const blocks = [];
            const fenceRegex = /```\s*mermaid\s*\n([\s\S]*?)```/gim;
            let m;
            while ((m = fenceRegex.exec(md)) !== null) {
                blocks.push(m[1].trim());
            }
            return blocks;
        }
        
        function navigateDiagram(delta) {
            if (diagrams.length === 0) return;
            diagramCurrentIndex = (diagramCurrentIndex + delta + diagrams.length) % diagrams.length;
            updateDiagramCounter();
            updateDiagramFocus();
        }
        function updateDiagramCounter() {
            const c = document.getElementById('counter');
            c.textContent = `${diagrams.length ? diagramCurrentIndex + 1 : 0} / ${diagrams.length}`;
        }
        function updateDiagramFocus() {
            diagrams.forEach((d, idx) => {
                d.element.classList.toggle('ring-2', idx === diagramCurrentIndex);
                d.element.classList.toggle('ring-blue-500', idx === diagramCurrentIndex);
                if (idx === diagramCurrentIndex) d.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }
        function changeDiagramZoom(delta) { setDiagramZoom(Math.min(3, Math.max(0.3, diagramZoom + delta))); }
        function setDiagramZoom(value) {
            diagramZoom = value;
            document.querySelectorAll('#gallery .diagram-wrapper').forEach(w => { w.style.transform = `scale(${diagramZoom})`; });
        }
        async function copyToClipboard(text) { try { await navigator.clipboard.writeText(text); } catch {} }
        
        // Load and display file list
        async function loadFileList() {
            const fileListEl = document.getElementById('fileList');
            const availableFiles = [];
            
            // Check which files exist
            for (const file of API_FILES) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        availableFiles.push(file);
                    }
                } catch (error) {
                    console.log(`File ${file} not accessible`);
                }
            }
            
            // Render file list
            if (availableFiles.length > 0) {
                let html = '<div class="space-y-2">';
                
                availableFiles.forEach(file => {
                    const displayName = formatFileName(file);
                    const icon = getFileIcon(file);
                    
                    html += `
                        <a href="#${file}" 
                           onclick="loadDocument('${file}'); return false;"
                           class="block p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                           data-file="${file}">
                            <div class="flex items-center">
                                <i class="${icon} text-blue-500 mr-3"></i>
                                <span class="font-medium text-gray-900 dark:text-white">
                                    ${displayName}
                                </span>
                            </div>
                        </a>
                    `;
                });
                
                html += '</div>';
                fileListEl.innerHTML = html;
            } else {
                fileListEl.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-folder-open text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 dark:text-gray-400">No documentation files found</p>
                        <p class="text-sm text-gray-500 dark:text-gray-500 mt-2">Add .md files to the design/ directory</p>
                    </div>
                `;
            }
        }
        
        // Format file name for display
        function formatFileName(filename) {
            return filename
                .replace('design/', '')
                .replace(/-rest-api-design\.md$/, '')
                .replace(/-/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase())
                .replace(/Api/g, 'API')
                .replace(/Ai/g, 'AI')
                .replace(/Cicd/g, 'CI/CD')
                .replace(/Rag/g, 'RAG')
                .replace(/Ui/g, 'UI');
        }
        
        // Get icon for file
        function getFileIcon(filename) {
            if (filename.includes('admin')) return 'fas fa-user-shield';
            if (filename.includes('ai')) return 'fas fa-brain';
            if (filename.includes('data')) return 'fas fa-database';
            if (filename.includes('deployment')) return 'fas fa-rocket';
            if (filename.includes('cicd')) return 'fas fa-code-branch';
            if (filename.includes('report')) return 'fas fa-chart-bar';
            return 'fas fa-file-code';
        }
        
        // Load and display document
        async function loadDocument(filename) {
            console.log('Loading document:', filename);
            
            // Update UI
            showLoading();
            updateActiveFile(filename);
            
            try {
                // Fetch the markdown file
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`Failed to load file: ${response.status}`);
                }
                
                // Get the content
                const content = await response.text();
                console.log('Fetched content, length:', content.length);
                
                // Store current file
                currentFile = filename;
                currentContent = content;
                
                // Update URL
                window.history.pushState({ file: filename }, '', `#${filename}`);
                
                // Render the markdown
                renderMarkdown(content, filename);
                
            } catch (error) {
                console.error('Error loading document:', error);
                showError(`Failed to load ${filename}: ${error.message}`);
            }
        }
        
        // Render markdown content
        function renderMarkdown(content, filename) {
            console.log('Rendering markdown...');
            
            // Update document title
            document.getElementById('docTitle').textContent = formatFileName(filename);
            document.getElementById('docPath').querySelector('span').textContent = filename;
            
            // Parse markdown to HTML
            if (typeof marked !== 'undefined') {
                try {
                    // Configure marked
                    marked.setOptions({
                        breaks: true,
                        gfm: true,
                        tables: true,
                        sanitize: false,
                        pedantic: false,
                        smartLists: true,
                        smartypants: false
                    });
                    
                    // Parse the markdown
                    const html = marked.parse(content);
                    console.log('Markdown parsed, HTML length:', html.length);
                    
                    // Set the HTML content
                    document.getElementById('markdownContent').innerHTML = html;
                    
                    // Apply syntax highlighting
                    if (typeof Prism !== 'undefined') {
                        Prism.highlightAll();
                    }

                    // Render Mermaid diagrams from fenced code blocks
                    try {
                        if (typeof mermaid !== 'undefined') {
                            mermaid.initialize({ startOnLoad: false });
                            const container = document.getElementById('markdownContent');
                            const codeBlocks = container.querySelectorAll('pre > code.language-mermaid, pre > code.mermaid');
                            codeBlocks.forEach(codeEl => {
                                const preEl = codeEl.parentElement;
                                const graphDefinition = codeEl.textContent;
                                const mermaidDiv = document.createElement('div');
                                mermaidDiv.className = 'mermaid';
                                mermaidDiv.textContent = graphDefinition;
                                // Replace the entire <pre> with the mermaid div
                                preEl.replaceWith(mermaidDiv);
                            });
                            // Initialize Mermaid on the inserted elements
                            mermaid.init(undefined, container.querySelectorAll('.mermaid'));
                        }
                    } catch (e) {
                        console.warn('Mermaid rendering failed:', e);
                    }
                    
                    // Show the content
                    showContent();
                    
                } catch (error) {
                    console.error('Error parsing markdown:', error);
                    // Show raw content as fallback
                    document.getElementById('markdownContent').innerHTML = `<pre>${escapeHtml(content)}</pre>`;
                    showContent();
                }
            } else {
                console.error('Marked.js is not loaded!');
                // Show raw content
                document.getElementById('markdownContent').innerHTML = `<pre>${escapeHtml(content)}</pre>`;
                showContent();
            }
        }
        
        // Escape HTML for safe display
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // UI State Management
        function showLoading() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('documentContent').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
        }
        
        function showContent() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            document.getElementById('documentContent').classList.remove('hidden');
        }
        
        function showError(message) {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('documentContent').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }
        
        // Update active file in sidebar
        function updateActiveFile(filename) {
            document.querySelectorAll('[data-file]').forEach(el => {
                el.classList.remove('bg-blue-50', 'dark:bg-blue-900/20');
                if (el.dataset.file === filename) {
                    el.classList.add('bg-blue-50', 'dark:bg-blue-900/20');
                }
            });
        }
        
        // Check URL hash for direct links
        function checkURLHash() {
            const hash = window.location.hash.slice(1);
            if (hash && API_FILES.includes(hash)) {
                loadDocument(hash);
            }
        }
    </script>
</body>
</html>